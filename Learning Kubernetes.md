# Learning Kubernetes

Notes going together with the YT video [Kubernetes Tutorial for Beginners [FULL COURSE in 4 Hours] - YouTube](https://www.youtube.com/watch?v=X48VuDVv0do) from "Techworld with Nana".

## K8S main components

### Node

Worker or node is the basic component of a K8S cluster. It contains 1 or more pods.

### Pod

One (1) pod $\approx$ 1 container $\approx$ 1 application.

A pod is an abstraction layer over the used container technology (docker, containerd, crio, ...). When created, they receive an IP address that allows them to communicate with other pods

Pods are ephemeral in nature and non persistent. When recreated they are resetted and receive an new IP. 

### Service

A service is an abstraction layer above (1 or more) pods. Services keep their IP addresses and acts as a load balancer by connecting to an underlying pod(s) to provide the requested service.

### Ingress

Allows external incomoing traffic to a service. It allows for external publication of a service.

![](C:\Users\Chris\AppData\Roaming\marktext\images\2021-12-29-22-10-47-image.png)

### Deployments: Replicaset (of pods)

Replica of pods are connected to the same service. Combined with a service, it acts as a load balancer in the K8S cluster.

`xtophe@rpi4a:~$ kubectl get deployments
NAME               READY   UP-TO-DATE   AVAILABLE   AGE
nginx-deployment   3/3     3            3           17d`

`xtophe@rpi4a:~$ kubectl get replicasets
NAME                          DESIRED   CURRENT   READY   AGE
nginx-deployment-66b6c48dd5   3         3         3       17d`

`xtophe@rpi4a:~$ kubectl get pods
NAME                                READY   STATUS    RESTARTS   AGE
aws-linux-priv                      1/1     Running   2          17d
nginx-deployment-66b6c48dd5-7rlj7   1/1     Running   2          17d
nginx-deployment-66b6c48dd5-r8tpg   1/1     Running   2          17d
nginx-deployment-66b6c48dd5-sbk4s   1/1     Running   2          17d
ubuntu-priv                         1/1     Running   2          18d`

### Statefulset (of DBs)

DBs (Mongo, Elastic, MySQL, ...) cannot just point to the same (persistent) volume. A specific mechanism is needed to avoid inconsistency = Stateful set. Difficult to setup and hence DB consistency is build outside of the K8S cluster

![](C:\Users\Chris\AppData\Roaming\marktext\images\2021-12-29-22-41-16-image.png)

### Debugging

- `kubectl exec -it <podname> -- bin/bash` ==> Provides (eventual) logs generated by the pod
- `kubectl edit <resourcetype> <resourcename>` ==> Using default editor, it will produce a yaml file of the configuration of the resource
- `kubectl logs <podname>` ==> Provides (eventual) logs generated by the pod
- `kubectl describe <resourcetype> <resourcename>` ==> Gives even more insights to what's happening in the pod

## K8S architecture

### Worker (slave)

*Manages the resources inside the node*

- Container runtime (docker, containerd, crio, ...)

- Kubelet
  
  - Link between "Node" and "pods". Assigns node resources to the different pods
  
  - Communicates using services between kubelets

- Kube proxy

### Master

*Manges the overall cluster*

- API server
  
  - Gateway to "talk" to the cluster
  
  - Gatekeeper of the cluster (checks rights and permissions)

- Scheduler: Decides what worker shold start a specific pod

- Controller manager: Detects state changes and acts upon them

- etcd: Contains current status of any k8s component = cluster brain

## K8S config file YAML structure

:exclamation: Attention points:

- Structure is submitted to strict indentation

- Keys in the key value pairs are camelCase

The YAML-file's structure is as follows:

1. Generic info
   
   - apiVersion:
   
   - kind:

2. Three (3) declarative parts:
   
   1. metadata
      Contains **labels**
   
   2. spec
      Attributes specific to the kind (resourcetype)
      Contains **selector**. The selector links with the label key value pair.
   
   3. status
      Autogenerated by K8S. Controller manager compares **actual** state (in etcd) with **desired** state (in yaml) and acts if needed.
